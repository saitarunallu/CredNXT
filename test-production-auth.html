<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Auth Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .test { margin: 10px 0; padding: 10px; background: white; border-radius: 5px; }
        .success { border-left: 4px solid green; }
        .error { border-left: 4px solid red; }
        .pending { border-left: 4px solid orange; }
    </style>
</head>
<body>
    <h1>CredNXT Production Authentication Test</h1>
    <div id="results"></div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyD2WtqVFyoXIQxD4XvFf7Mwx-CvvGCM3zg",
            authDomain: "crednxt-ef673.firebaseapp.com",
            projectId: "crednxt-ef673",
            storageBucket: "crednxt-ef673.appspot.com",
            messagingSenderId: "962728894234",
            appId: "1:962728894234:web:3f7e8e5f4d5c2b1a9b8c7d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const results = document.getElementById('results');

        function addResult(message, status = 'pending') {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.textContent = message;
            results.appendChild(div);
            return div;
        }

        async function testFirebaseConnection() {
            const test = addResult('Testing Firebase connection...');
            try {
                const testDoc = await getDoc(doc(db, 'offers', 'test-offer-123'));
                if (testDoc.exists()) {
                    test.textContent = '‚úÖ Firebase connection successful - test offer exists';
                    test.className = 'test success';
                    return testDoc.data();
                } else {
                    test.textContent = '‚ùå Test offer not found';
                    test.className = 'test error';
                    return null;
                }
            } catch (error) {
                test.textContent = `‚ùå Firebase connection failed: ${error.message}`;
                test.className = 'test error';
                return null;
            }
        }

        async function testDirectOfferAccess() {
            const test = addResult('Testing direct offer access...');
            try {
                const response = await fetch('/offers/test-offer-123');
                if (response.ok) {
                    const html = await response.text();
                    if (html.includes('CredNXT')) {
                        test.textContent = `‚úÖ Direct offer access successful (${response.status})`;
                        test.className = 'test success';
                    } else {
                        test.textContent = `‚ö†Ô∏è Response received but may not be app content`;
                        test.className = 'test pending';
                    }
                } else {
                    test.textContent = `‚ùå Direct offer access failed (${response.status})`;
                    test.className = 'test error';
                }
            } catch (error) {
                test.textContent = `‚ùå Fetch failed: ${error.message}`;
                test.className = 'test error';
            }
        }

        async function runTests() {
            addResult(`üß™ Starting production tests at ${new Date().toISOString()}`);
            addResult(`üìç Testing from: ${window.location.hostname}`);
            
            const offerData = await testFirebaseConnection();
            if (offerData) {
                addResult(`üí∞ Offer amount: ‚Çπ${offerData.amount}`);
                addResult(`üë§ From user: ${offerData.fromUserId}`);
                addResult(`üìù Note: ${offerData.note || 'No note'}`);
            }
            
            await testDirectOfferAccess();
            
            addResult(`üîó Test URLs:`);
            addResult(`- Main app: https://crednxt-ef673.web.app/`);
            addResult(`- Debug auth: https://crednxt-ef673.web.app/debug-auth`);
            addResult(`- Test offer: https://crednxt-ef673.web.app/offers/test-offer-123`);
        }

        runTests();
    </script>
</body>
</html>