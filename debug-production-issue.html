<!DOCTYPE html>
<html>
<head>
    <title>Debug Production Issue - Sai Tarun Allu</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyD2WtHqc8tOZ8w4Z4Z4Z4Z4Z4Z4Z4Z4Z4Z",
            authDomain: "crednxt-ef673.firebaseapp.com",
            projectId: "crednxt-ef673",
            storageBucket: "crednxt-ef673.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456789"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        async function debugProductionIssue() {
            console.log('üîç Starting production debug...');
            
            try {
                // Target user details
                const targetUserId = 'xt8OK1z2PifGrAkeDA2OUVjSlLW2';
                const targetPhone = '+919676561932';
                
                console.log(`üéØ Debugging user: ${targetUserId} with phone: ${targetPhone}`);
                
                // Get all offers to understand the data structure
                const offersCollection = collection(db, 'offers');
                const allOffersSnapshot = await getDocs(offersCollection);
                const allOffers = allOffersSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log(`üìä Total offers found: ${allOffers.length}`);
                
                allOffers.forEach((offer, index) => {
                    console.log(`${index + 1}. Offer ${offer.id}:`);
                    console.log(`   - fromUserId: ${offer.fromUserId}`);
                    console.log(`   - toUserId: ${offer.toUserId}`);
                    console.log(`   - toUserPhone: ${offer.toUserPhone}`);
                    console.log(`   - status: ${offer.status}`);
                    console.log(`   - amount: ${offer.amount}`);
                });
                
                // Test specific queries that should work for Sai Tarun
                console.log('\nüîç Testing fromUserId query...');
                const sentQuery = query(offersCollection, where('fromUserId', '==', targetUserId));
                const sentSnapshot = await getDocs(sentQuery);
                console.log(`üì§ Sent offers found: ${sentSnapshot.size}`);
                
                console.log('\nüîç Testing toUserId query...');
                const receivedQuery = query(offersCollection, where('toUserId', '==', targetUserId));
                const receivedSnapshot = await getDocs(receivedQuery);
                console.log(`üì• Received offers (toUserId): ${receivedSnapshot.size}`);
                
                // Test phone number variations
                const phoneVariants = [
                    '+919676561932',
                    '9676561932',
                    '919676561932'
                ];
                
                for (const phoneVariant of phoneVariants) {
                    console.log(`\nüîç Testing phone query for: ${phoneVariant}`);
                    const phoneQuery = query(offersCollection, where('toUserPhone', '==', phoneVariant));
                    const phoneSnapshot = await getDocs(phoneQuery);
                    console.log(`üì± Phone offers found: ${phoneSnapshot.size}`);
                }
                
                // Manual filtering to see what matches
                const manualMatches = allOffers.filter(offer => {
                    const matchesFromUser = offer.fromUserId === targetUserId;
                    const matchesToUser = offer.toUserId === targetUserId;
                    const matchesToPhone = phoneVariants.some(variant => offer.toUserPhone === variant);
                    
                    return matchesFromUser || matchesToUser || matchesToPhone;
                });
                
                console.log(`\nüéØ Manual filter matches: ${manualMatches.length}`);
                manualMatches.forEach(offer => {
                    console.log(`‚úÖ Match: ${offer.id} - from:${offer.fromUserId} to:${offer.toUserId || offer.toUserPhone}`);
                });
                
            } catch (error) {
                console.error('‚ùå Debug error:', error);
            }
        }

        // Run debug when page loads
        debugProductionIssue();
        
        // Add to window for manual testing
        window.debugProductionIssue = debugProductionIssue;
    </script>
</head>
<body>
    <h1>Debug Production Issue</h1>
    <p>Check console for debug output</p>
    <button onclick="debugProductionIssue()">Run Debug Again</button>
</body>
</html>