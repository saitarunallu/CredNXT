<!DOCTYPE html>
<html>
<head>
    <title>Notification Authentication Test</title>
</head>
<body>
    <h1>Notification System Test</h1>
    <div id="status"></div>
    <div id="notifications"></div>
    
    <script>
        const statusDiv = document.getElementById('status');
        const notificationsDiv = document.getElementById('notifications');

        async function testAuth() {
            statusDiv.innerHTML = 'üîç Testing authentication and notifications...<br>';
            
            // Check if user is logged in
            const userData = localStorage.getItem('user_data');
            const authToken = localStorage.getItem('firebase_auth_token');
            
            statusDiv.innerHTML += `üì± User data: ${userData ? 'Found' : 'Not found'}<br>`;
            statusDiv.innerHTML += `üîë Auth token: ${authToken ? 'Found' : 'Not found'}<br>`;
            
            if (!userData || !authToken) {
                statusDiv.innerHTML += '‚ùå Authentication required. Please log in first.<br>';
                return;
            }
            
            try {
                const user = JSON.parse(userData);
                statusDiv.innerHTML += `üë§ User: ${user.name} (${user.phone})<br>`;
                
                // Test notifications API
                statusDiv.innerHTML += 'üìû Testing notifications API...<br>';
                
                const response = await fetch('/api/notifications', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                statusDiv.innerHTML += `üìä Response status: ${response.status}<br>`;
                
                if (response.ok) {
                    const data = await response.json();
                    statusDiv.innerHTML += `‚úÖ Notifications loaded: ${data.notifications?.length || 0} found<br>`;
                    
                    if (data.notifications && data.notifications.length > 0) {
                        notificationsDiv.innerHTML = '<h3>Recent Notifications:</h3>';
                        data.notifications.slice(0, 5).forEach(notification => {
                            notificationsDiv.innerHTML += `
                                <div style="border: 1px solid #ccc; padding: 10px; margin: 5px;">
                                    <strong>${notification.title}</strong><br>
                                    ${notification.message}<br>
                                    <small>Type: ${notification.type} | Read: ${notification.isRead ? 'Yes' : 'No'}</small>
                                </div>
                            `;
                        });
                    } else {
                        notificationsDiv.innerHTML = '<p>No notifications found.</p>';
                    }
                } else {
                    const errorText = await response.text();
                    statusDiv.innerHTML += `‚ùå API Error: ${errorText}<br>`;
                }
                
            } catch (error) {
                statusDiv.innerHTML += `üí• Error: ${error.message}<br>`;
            }
        }

        // Run test when page loads
        testAuth();
    </script>
</body>
</html>