<!DOCTYPE html>
<html>
<head>
    <title>Debug Offer Update</title>
</head>
<body>
    <h1>Debug Offer Accept/Reject</h1>
    <div id="debug-output"></div>
    
    <script type="module">
        // Test the offer accept/reject functionality directly
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getFirestore, doc, updateDoc, serverTimestamp, getDoc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyD2WtqZHxH0M0bk26Z5s4L-9OXaKqEpFJw",
            authDomain: "crednxt-ef673.firebaseapp.com",
            projectId: "crednxt-ef673",
            storageBucket: "crednxt-ef673.firebasestorage.app",
            messagingSenderId: "462092924096",
            appId: "1:462092924096:web:d18e9b2c8b9e8b0a35b8e5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const debugOutput = document.getElementById('debug-output');
        
        function log(message) {
            console.log(message);
            debugOutput.innerHTML += `<p>${new Date().toISOString()}: ${message}</p>`;
        }

        // Test offer update function
        async function testOfferUpdate(offerId, newStatus) {
            log(`üéØ Testing offer update: ${offerId} -> ${newStatus}`);
            
            try {
                // Check authentication
                const user = auth.currentUser;
                log(`üë§ Current user: ${user ? user.uid : 'not authenticated'}`);
                
                if (!user) {
                    throw new Error('User not authenticated');
                }
                
                // Get offer document
                const offerRef = doc(db, 'offers', offerId);
                const offerSnap = await getDoc(offerRef);
                
                if (!offerSnap.exists()) {
                    throw new Error('Offer not found');
                }
                
                const offerData = offerSnap.data();
                log(`üìã Offer data: toUserId=${offerData.toUserId}, currentUserId=${user.uid}`);
                
                // Check authorization
                if (offerData.toUserId !== user.uid) {
                    throw new Error('Not authorized to update this offer');
                }
                
                // Update the offer
                await updateDoc(offerRef, {
                    status: newStatus,
                    updatedAt: serverTimestamp()
                });
                
                log(`‚úÖ Offer updated successfully to: ${newStatus}`);
                return { success: true };
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                throw error;
            }
        }

        // Wait for auth and test
        onAuthStateChanged(auth, (user) => {
            if (user) {
                log(`‚úÖ User authenticated: ${user.uid}`);
                
                // Test with a real offer ID - you'll need to provide this
                window.testAccept = () => testOfferUpdate('test-offer-123', 'accepted');
                window.testReject = () => testOfferUpdate('test-offer-123', 'declined');
                
                debugOutput.innerHTML += `
                    <button onclick="testAccept()">Test Accept Offer</button>
                    <button onclick="testReject()">Test Reject Offer</button>
                `;
            } else {
                log('‚ùå User not authenticated - please log in first');
            }
        });
    </script>
</body>
</html>